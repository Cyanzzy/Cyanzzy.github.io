---
title: DL-MULI-1-数据操作与数据预处理
date: 2023-09-08 11:27:27
tags: 
  - DL
categories: 
  - Science
---

# 数据操作

> N维数组样例

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-01.png)

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-02.png)

## 创建数组

> 创建数组需要

* 形状：3×4的矩阵
* 每个元素类型：Float32
* 每个元素的值：

## 访问元素

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-03.png)

1. `::3`：这部分控制了第一个维度的切片操作。`::` 表示从开始到结束（包括开始和结束），而 `3` 表示步长，即每隔3个元素取一个。所以，`::3` 表示从第一个元素开始，每隔3个元素取一个。
2. `::2`：这部分控制了第二个维度的切片操作，但前提是你的序列是一个多维的数据结构（比如二维数组或矩阵）。同样，`::` 表示从开始到结束，而 `2` 表示步长，即每隔2个元素取一个。这部分是可选的，如果你的序列只有一个维度，可以省略。

## 数据操作

在深度学习中，张量（tensor）是一种多维数组（通常是数字）数据结构，它是深度学习中最基本的数据表示形式之一。张量可以看作是具有固定形状（维度）的多维矩阵，这些形状可以是一维、二维、三维，甚至更高维度的。深度学习中的大部分计算涉及到张量的操作，包括输入数据、模型参数和输出结果。 

1. **维度（Rank）：** 张量的维度通常称为“rank”，它表示张量的阶数或维度数量。例如，一维张量是向量，二维张量是矩阵，三维张量可以看作是一个数据立方体，以此类推。
2. **形状（Shape）：** 张量的形状描述了它在每个维度上的大小。例如，一个形状为 `(3, 4)` 的二维张量表示一个3行4列的矩阵。
3. **数据类型（Data Type）：** 张量中的元素可以具有不同的数据类型，如浮点数、整数等。不同的深度学习框架支持不同的数据类型。
4. **张量操作：** 在深度学习中，各种数学操作（如加法、乘法、卷积、池化等）都可以用张量来表示。深度学习框架提供了张量操作的函数和工具，用于构建神经网络模型。
5. **张量的创建：** 张量可以从现有数据中创建，也可以作为神经网络的权重和偏置进行初始化。通常，数据从训练集中加载为张量，并在模型中传递和处理。
6. **张量的传播：** 在神经网络中，张量沿着网络层传播。输入张量通过一系列的层级转化为输出张量。每个层级都执行一些数学运算，通常涉及到权重张量的乘法和激活函数的应用。
7. **梯度计算：** 在深度学习中，梯度是非常重要的，它表示了损失函数相对于模型参数的变化率。梯度计算涉及到对张量进行微分运算，用于优化模型参数以最小化损失函数。
8. **GPU加速：** 张量计算通常可以受益于图形处理单元（GPU）的加速。深度学习框架通常提供了支持GPU加速的功能，以加快模型训练和推断的速度。

张量表示一个数值组成的数组，该数组可能有多个维度

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-68.png)

可以通过张量的`shape`属性访问张量的形状和张量中的元素个数。 如果只想知道张量中元素的总数，即形状的所有元素乘积，可以检查它的大小（size）。 因为这里在处理的是一个向量，所以它的`shape`与它的`size`相同。 

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-69.png)

要改变一个张量的形状而不改变元素数量和元素值可以使用`reshape`函数。 

注意，通过改变张量的形状，张量的大小不会改变。 

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-70.png)

 有时，我们希望使用全0、全1、其他常量，或者从特定分布中随机采样的数字来初始化矩阵。 

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-71.png)



 有时我们想通过从某个特定的概率分布中随机采样来得到张量中每个元素的值。 

例如，当我们构造数组来作为神经网络中的参数时，我们通常会随机初始化参数的值。 以下代码创建一个形状为（3,4）的张量。 其中的每个元素都从均值为0、标准差为1的标准高斯分布（正态分布）中随机采样。 

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-85.png)

通过提供包含数值的Python列表（或嵌套列表）来为所需张量中的每个元素赋予确定值。在这里，最外层的列表对应于轴0，内层的列表对应于轴1。 

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-72.png)

##  运算符

对于任意具有相同形状的张量， 常见的标准算术运算符（`+`、`-`、`*`、`/`和`**`）都可以被升级为按元素运算。 我们可以在同一形状的任意两个张量上调用按元素操作。 在下面的例子中，我们使用逗号来表示一个具有5个元素的元组，其中每个元素都是按元素操作的结果。 

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-73.png)

 “按元素”方式可以应用更多的计算，包括像求幂这样的一元运算符。 

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-86.png)

 我们也可以把多个张量`连结`（concatenate）在一起， 把它们端对端地叠起来形成一个更大的张量。 我们只需要提供张量列表，并给出沿哪个轴连结 

 下面的例子分别演示了当我们沿行（轴-0，形状的第一个元素） 和按列（轴-1，形状的第二个元素）连结两个矩阵时，会发生什么情况。 我们可以看到，第一个输出张量的轴-0长度$(6)$是两个输入张量轴-0长度的总和$(3+3)$； 第二个输出张量的轴-1长度$(8)$是两个输入张量轴-1长度的总和$(4+4)$

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-74.png)

 有时，我们想通过`逻辑运算符`构建二元张量。

 以`X == Y`为例： 对于每个位置，如果`X`和`Y`在该位置相等，则新张量中相应项的值为1。 这意味着逻辑语句`X == Y`在该位置处为真，否则该位置为0。 

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-75.png)

对张量中的所有元素进行求和会产生一个只有一个元素的张量

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-76.png)

## 广播机制

在上面的部分中，我们看到了如何在相同形状的两个张量上执行按元素操作。 在某些情况下，即使形状不同，我们仍然可以通过调用 `广播机制`（broadcasting mechanism）来执行按元素操作。 

 PyTorch中的广播机制是一种强大的功能，它允许你在进行元素级操作（例如加法、减法、乘法等）时，对不同形状的张量进行操作，而不需要显式地扩展它们的形状。广播机制的目标是使操作的输入张量具有相同的形状，以便进行逐元素运算，而无需复制数据或显式更改形状。 

**广播规则：** 在PyTorch中，当进行元素级操作时，系统会根据以下规则来自动执行广播：

- 如果两个张量的维度数量不同，将维度较少的张量进行扩展，以匹配维度较多的张量的形状。扩展是通过在维度大小为1的维度上重复元素来完成的。
- 如果两个张量的维度数量相同，但在某些维度上大小不匹配，将执行广播，以使这些维度的大小匹配。具体方法是选择适当的维度进行扩展，使它们具有相同的大小。
- 如果两个张量的形状在任何维度上都不兼容，那么广播操作将引发错误。



 在大多数情况下，我们将沿着数组中长度为1的轴进行广播 ,

 由于`a`和`b`分别是 $3×1$ 和 $1×2$ 矩阵，如果让它们相加，它们的形状不匹配。 我们将两个矩阵`广播`为一个更大的 $3×2$ 矩阵，如下所示：矩阵`a`将复制列， 矩阵`b`将复制行，然后再按元素相加。 

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-77.png)





## 索引和切片

 就像在任何其他Python数组中一样，张量中的元素可以通过索引访问。 与任何Python数组一样：第一个元素的索引是0，最后一个元素索引是-1； 可以指定范围以包含第一个元素和最后一个之前的元素。 

 如下所示，我们可以用`[-1]`选择最后一个元素，可以用`[1:3]`选择第二个和第三个元素： 

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-78.png)

 除读取外，我们还可以通过指定索引来将元素写入矩阵。 

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-79.png)

为多个元素赋值相同的值，我们只需要索引所有元素，然后为他们赋值

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-80.png)

## 转换为其他Python对象

 将深度学习框架定义的张量转换为NumPy张量（`ndarray`）很容易，反之也同样容易。 torch张量和numpy数组将共享它们的底层内存，就地操作更改一个张量也会同时更改另一个张量 

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-81.png)

 要将大小为1的张量转换为Python标量，我们可以调用`item`函数或Python的内置函数。 

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-82.png)

# 数据预处理

## 读取数据集

 举一个例子，我们首先创建一个人工数据集，并存储在CSV（逗号分隔值）文件 `../data/house_tiny.csv`中。 以其他格式存储的数据也可以通过类似的方式进行处理。 

创建一个人工数据集，并存储在csv（逗号分隔值）文件

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-83.png)

 要从创建的CSV文件中加载原始数据集，我们导入`pandas`包并调用`read_csv`函数。该数据集有四行三列。其中每行描述了房间数量（“NumRooms”）、巷子类型（“Alley”）和房屋价格（“Price”）。 

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-84.png)

## 处理缺失值

 注意，“NaN”项代表缺失值。 为了处理缺失的数据，典型的方法包括`插值法`和`删除法`， 其中插值法用一个替代值弥补缺失值，而删除法则直接忽略缺失值。 在这里，我们将考虑插值法。 

 通过位置索引`iloc`，我们将`data`分成`inputs`和`outputs`， 其中前者为`data`的前两列，而后者为`data`的最后一列。 对于`inputs`中缺少的数值，我们用同一列的均值替换“NaN”项。 

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-87.png)

 对于`inputs`中的类别值或离散值，我们将“NaN”视为一个类别。 由于“巷子类型”（“Alley”）列只接受两种类型的类别值“Pave”和“NaN”， `pandas`可以自动将此列转换为两列“Alley_Pave”和“Alley_nan”。 巷子类型为“Pave”的行会将“Alley_Pave”的值设置为1，“Alley_nan”的值设置为0。 缺少巷子类型的行会将“Alley_Pave”和“Alley_nan”分别设置为0和1。 

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-88.png)

## 转换为张量格式

 现在`inputs`和`outputs`中的所有条目都是数值类型，它们可以转换为张量格式。 

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/deep-learning-20230716-89.png)